<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="nuist_trade_history">
  <resultMap class="com.linklife.domain.ibator.NuistTradeHistory" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    <result column="trade_id" jdbcType="INTEGER" property="tradeId" />
    <result column="account_id" jdbcType="INTEGER" property="accountId" />
    <result column="user_number" jdbcType="VARCHAR" property="userNumber" />
    <result column="shop_id" jdbcType="INTEGER" property="shopId" />
    <result column="shop_name" jdbcType="VARCHAR" property="shopName" />
    <result column="shop_area" jdbcType="INTEGER" property="shopArea" />
    <result column="trade_amount" jdbcType="DOUBLE" property="tradeAmount" />
    <result column="trade_type" jdbcType="INTEGER" property="tradeType" />
    <result column="trade_time" jdbcType="TIMESTAMP" property="tradeTime" />
  </resultMap>
  <resultMap id="amountmap" class="java.util.HashMap">
		<result property="shopName" column="shop_name" javaType="java.lang.String" />
		<result property="amounts" column="amounts" javaType="java.lang.Double" />
	</resultMap>
	<resultMap id="areamap" class="com.linklife.domain.model.AreaRankModel">
		<result property="shopName" column="shop_name" javaType="java.lang.String" />
		<result property="amounts" column="amounts" javaType="java.lang.Double" />
		<result property="times" column="times" javaType="java.lang.Integer" />
		<result property="average" column="average" javaType="java.lang.Double" />
	</resultMap>
	<resultMap id="rankmap" class="com.linklife.domain.model.RankModel">
		<result property="shopName" column="shop_name" javaType="java.lang.String" />
		<result property="amounts" column="amounts" javaType="java.lang.Double" />
		<result property="times" column="times" javaType="java.lang.Integer" />
		<result property="average" column="average" javaType="java.lang.Double" />
		<result property="people" column="people" javaType="java.lang.Integer" />
		<result property="perbill" column="perbill" javaType="java.lang.Double" />
	</resultMap>
	<resultMap id="timemap" class="java.util.HashMap">
		<result property="shopName" column="shop_name" javaType="java.lang.String" />
		<result property="times" column="times" javaType="java.lang.Integer" />
	</resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" parameterClass="com.linklife.domain.ibator.NuistTradeHistoryExample" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    select trade_id, account_id, user_number, shop_id, shop_name, shop_area, trade_amount,
      trade_type, trade_time
    from nuist_trade_history
    <isParameterPresent>
      <include refid="nuist_trade_history.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.linklife.domain.ibator.NuistTradeHistory" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    select trade_id, account_id, user_number, shop_id, shop_name, shop_area, trade_amount,
      trade_type, trade_time
    from nuist_trade_history
    where trade_id = #tradeId:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    delete from nuist_trade_history
    where trade_id = #tradeId:INTEGER#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.linklife.domain.ibator.NuistTradeHistoryExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    delete from nuist_trade_history
    <include refid="nuist_trade_history.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    insert into nuist_trade_history (account_id, user_number, shop_id, shop_name, shop_area,
      trade_amount, trade_type, trade_time)
    values (#accountId:INTEGER#, #userNumber:VARCHAR#, #shopId:INTEGER#, #shopName:VARCHAR#,
      #shopArea:INTEGER#, #tradeAmount:DOUBLE#, #tradeType:INTEGER#, #tradeTime:TIMESTAMP#)
    <selectKey keyProperty="tradeId" resultClass="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    insert into nuist_trade_history
    <dynamic prepend="(">
      <isNotNull prepend="," property="accountId">
        account_id
      </isNotNull>
      <isNotNull prepend="," property="userNumber">
        user_number
      </isNotNull>
      <isNotNull prepend="," property="shopId">
        shop_id
      </isNotNull>
      <isNotNull prepend="," property="shopName">
        shop_name
      </isNotNull>
      <isNotNull prepend="," property="shopArea">
        shop_area
      </isNotNull>
      <isNotNull prepend="," property="tradeAmount">
        trade_amount
      </isNotNull>
      <isNotNull prepend="," property="tradeType">
        trade_type
      </isNotNull>
      <isNotNull prepend="," property="tradeTime">
        trade_time
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="accountId">
        #accountId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="userNumber">
        #userNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="shopId">
        #shopId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="shopName">
        #shopName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="shopArea">
        #shopArea:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tradeAmount">
        #tradeAmount:DOUBLE#
      </isNotNull>
      <isNotNull prepend="," property="tradeType">
        #tradeType:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tradeTime">
        #tradeTime:TIMESTAMP#
      </isNotNull>
      )
    </dynamic>
    <selectKey keyProperty="tradeId" resultClass="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.linklife.domain.ibator.NuistTradeHistoryExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    select count(*) from nuist_trade_history
    <include refid="nuist_trade_history.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    update nuist_trade_history
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.tradeId">
        trade_id = #record.tradeId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.accountId">
        account_id = #record.accountId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.userNumber">
        user_number = #record.userNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.shopId">
        shop_id = #record.shopId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.shopName">
        shop_name = #record.shopName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.shopArea">
        shop_area = #record.shopArea:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.tradeAmount">
        trade_amount = #record.tradeAmount:DOUBLE#
      </isNotNull>
      <isNotNull prepend="," property="record.tradeType">
        trade_type = #record.tradeType:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.tradeTime">
        trade_time = #record.tradeTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="nuist_trade_history.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    update nuist_trade_history
    set trade_id = #record.tradeId:INTEGER#,
      account_id = #record.accountId:INTEGER#,
      user_number = #record.userNumber:VARCHAR#,
      shop_id = #record.shopId:INTEGER#,
      shop_name = #record.shopName:VARCHAR#,
      shop_area = #record.shopArea:INTEGER#,
      trade_amount = #record.tradeAmount:DOUBLE#,
      trade_type = #record.tradeType:INTEGER#,
      trade_time = #record.tradeTime:TIMESTAMP#
    <isParameterPresent>
      <include refid="nuist_trade_history.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    update nuist_trade_history
    <dynamic prepend="set">
      <isNotNull prepend="," property="accountId">
        account_id = #accountId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="userNumber">
        user_number = #userNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="shopId">
        shop_id = #shopId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="shopName">
        shop_name = #shopName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="shopArea">
        shop_area = #shopArea:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tradeAmount">
        trade_amount = #tradeAmount:DOUBLE#
      </isNotNull>
      <isNotNull prepend="," property="tradeType">
        trade_type = #tradeType:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tradeTime">
        trade_time = #tradeTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where trade_id = #tradeId:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Sun Jul 12 10:32:21 CST 2015.
    -->
    update nuist_trade_history
    set account_id = #accountId:INTEGER#,
      user_number = #userNumber:VARCHAR#,
      shop_id = #shopId:INTEGER#,
      shop_name = #shopName:VARCHAR#,
      shop_area = #shopArea:INTEGER#,
      trade_amount = #tradeAmount:DOUBLE#,
      trade_type = #tradeType:INTEGER#,
      trade_time = #tradeTime:TIMESTAMP#
    where trade_id = #tradeId:INTEGER#
  </update>
  
	<select id="selectByUserNumberAndTradeTime" resultMap="ibatorgenerated_BaseResultMap"
		parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
		<![CDATA[
		select trade_id, account_id, user_number, shop_name, trade_amount,
		trade_type, trade_time
		from nuist_trade_history
		where trade_id =
		#userNumber:VARCHAR#
		and
		trade_time = #tradeTime:TIMESTAMP#
		]]>
	</select>

	<select id="query4AmountRank" resultMap="amountmap"
		parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts 
		from linklife.nuist_trade_history a 
		where a.trade_type=1 
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 10
		]]>
	</select>

	<select id="query4EastRank" resultMap="areamap">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts ,count(a.shop_name) as times,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 and a.shop_name like '东%'
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4CenterRank" resultMap="areamap">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts ,count(a.shop_name) as times,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 and a.shop_name like '中%'
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4WestRank" resultMap="areamap">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts ,count(a.shop_name) as times,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 and a.shop_name like '西%'
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4TimeRank" resultMap="timemap"
		parameterClass="com.linklife.domain.ibator.NuistTradeHistory">
		<![CDATA[
		select a.shop_name,COUNT(*) as times 
		from linklife.nuist_trade_history a 
		where a.trade_type=1 
		GROUP BY a.shop_name 
		ORDER BY times 
		DESC 
		LIMIT 10
		]]>
	</select>

	<select id="query4MyEastRank" resultMap="areamap"
		parameterClass="java.lang.String">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts ,count(a.shop_name) as times,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 
		and a.shop_name like '东%' 
		and a.user_number=
		#userNumber:VARCHAR#
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4MyCenterRank" resultMap="areamap"
		parameterClass="java.lang.String">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts ,count(a.shop_name) as times,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 
		and a.shop_name like '中%' 
		and a.user_number=
		#userNumber:VARCHAR#
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4MyWestRank" resultMap="areamap"
		parameterClass="java.lang.String">
		<![CDATA[
		select a.shop_name,sum(a.trade_amount) as amounts ,count(a.shop_name) as times,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 
		and a.shop_name like '西%' 
		and a.user_number=
		#userNumber:VARCHAR#
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4MyTimeRank" resultMap="timemap"
		parameterClass="java.lang.String">
		<![CDATA[
		select a.shop_name,COUNT(*) as times 
		from linklife.nuist_trade_history a 
		where a.trade_type=1 
		and a.user_number=
		#userNumber:VARCHAR#
		GROUP BY a.shop_name 
		ORDER BY times 
		DESC 
		LIMIT 10
		]]>
	</select>

	<select id="query4People" resultClass="java.lang.Integer">
		<![CDATA[
		SELECT count(*) 
		from (
		select a.user_number 
		from linklife.nuist_trade_history a 
		GROUP BY a.user_number) a 
		where 1=1
		]]>
	</select>

	<select id="query4DataSize" resultClass="java.lang.Integer">
		<![CDATA[
		select count(a.trade_id) 
		from linklife.nuist_trade_history a
		]]>
	</select>
	<select id="query4EastAmountRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,floor(sum(a.trade_amount)) as amounts ,count(a.shop_name) as times
		from linklife.nuist_trade_history a 
		where a.shop_area=1
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4CenterAmountRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,floor(sum(a.trade_amount)) as amounts ,count(a.shop_name) as times
		from linklife.nuist_trade_history a 
		where a.shop_area=2
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4WestAmountRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,floor(sum(a.trade_amount)) as amounts ,count(a.shop_name) as times
		from linklife.nuist_trade_history a 
		where a.shop_area=3
		GROUP BY a.shop_name 
		ORDER BY amounts 
		DESC 
		LIMIT 5
		]]>
	</select>
	<select id="query4EastPopularityRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,count(DISTINCT a.account_id) as people ,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.shop_area=1
		GROUP BY a.shop_name 
		ORDER BY people 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4CenterPopularityRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,count(DISTINCT a.account_id) as people ,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.shop_area=2
		GROUP BY a.shop_name 
		ORDER BY people 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4WestPopularityRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,count(DISTINCT a.account_id) as people ,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.shop_area=3
		GROUP BY a.shop_name 
		ORDER BY people 
		DESC 
		LIMIT 5
		]]>
	</select>
	<select id="query4EastPerConsumeRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,ROUND(AVG(a.trade_amount),1) as average,count(a.shop_name) as times
		from linklife.nuist_trade_history a 
		where a.shop_area=1
		GROUP BY a.shop_name 
		ORDER BY average
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4CenterPerConsumeRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,ROUND(AVG(a.trade_amount),1) as average,count(a.shop_name) as times
		from linklife.nuist_trade_history a 
		where a.trade_type=1 and a.shop_area=2
		GROUP BY a.shop_name 
		ORDER BY average
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4WestPerConsumeRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,ROUND(AVG(a.trade_amount),1) as average,count(a.shop_name) as times
		from linklife.nuist_trade_history a 
		where a.shop_area=3
		GROUP BY a.shop_name 
		ORDER BY average
		DESC 
		LIMIT 5
		]]>
	</select>
	<select id="query4EastCostMostRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,MAX(a.trade_amount) as perbill,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.shop_area=1
		GROUP BY a.shop_name 
		ORDER BY perbill 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4CenterCostMostRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,MAX(a.trade_amount) as perbill,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.trade_type=1 and a.shop_area=2
		GROUP BY a.shop_name 
		ORDER BY perbill 
		DESC 
		LIMIT 5
		]]>
	</select>

	<select id="query4WestCostMostRank" resultClass="com.linklife.domain.model.RankModel">
		<![CDATA[
		select a.shop_name as shopName,MAX(a.trade_amount) as perbill,ROUND(AVG(a.trade_amount),1) as average
		from linklife.nuist_trade_history a 
		where a.shop_area=3
		GROUP BY a.shop_name 
		ORDER BY perbill 
		DESC 
		LIMIT 5
		]]>
	</select>
</sqlMap>